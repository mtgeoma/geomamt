      SUBROUTINE D02HBX(ISTATE,IFLAG,IFAIL1,P,M,F,PNORM,PNORM1,EPS,D)
C     MARK 8 RELEASE. NAG COPYRIGHT 1979.
C     MARK 10 REVISED. IER-376 (JUN 1982).
C     MARK 11.5(F77) REVISED. (SEPT 1985.)
C     MONIT ROUTINE FOR D02HBF AND D02HAF
C     SEE SPECIFICATION OF D02SAF FOR DETAILS.
C     .. Scalar Arguments ..
      DOUBLE PRECISION  EPS, PNORM, PNORM1
      INTEGER           IFAIL1, IFLAG, ISTATE, M
C     .. Array Arguments ..
      DOUBLE PRECISION  D(M), F(M), P(M)
C     .. Scalars in Common ..
      INTEGER           ICASE, IFAIL2, IFAIL3, IW1
C     .. Arrays in Common ..
      DOUBLE PRECISION  W(7)
      INTEGER           IW(4)
C     .. Local Scalars ..
      INTEGER           I, J, NADV
C     .. Local Arrays ..
      CHARACTER*80      REC(2)
C     .. External Subroutines ..
      EXTERNAL          X04ABF, X04BAF
C     .. Intrinsic Functions ..
      INTRINSIC         MIN
C     .. Common blocks ..
      COMMON            /AD02HB/IFAIL2, IFAIL3
      COMMON            /AD02SA/W, IW, IW1, ICASE
C     .. Executable Statements ..
      IF (IFAIL3.EQ.0) RETURN
      IF (ISTATE.EQ.6 .AND. ICASE.GE.2) RETURN
      CALL X04ABF(0,NADV)
      CALL X04BAF(NADV,' ')
      IF (ICASE.EQ.1) WRITE (REC,FMT=99986)
      IF (ICASE.EQ.2) WRITE (REC,FMT=99985)
      IF (ICASE.EQ.3) WRITE (REC,FMT=99984)
      CALL X04BAF(NADV,REC(1))
      IF (ISTATE) 20, 120, 220
   20 IF (ISTATE.EQ.-7) GO TO 60
      WRITE (REC,FMT=99998)
      CALL X04BAF(NADV,REC(1))
      IF (ICASE.LE.2) THEN
         WRITE (REC,FMT=99999) ISTATE, IFAIL1, IFLAG
         CALL X04BAF(NADV,REC(1))
      END IF
      WRITE (REC,FMT=99996)
      CALL X04BAF(NADV,REC(1))
      DO 40 J = 1, M, 5
         WRITE (REC,FMT=99997) (P(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
   40 CONTINUE
      RETURN
   60 WRITE (REC,FMT=99994)
      CALL X04BAF(NADV,REC(1))
      DO 80 J = 1, M, 5
         WRITE (REC,FMT=99997) (P(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
   80 CONTINUE
      WRITE (REC,FMT=99995)
      CALL X04BAF(NADV,REC(1))
      DO 100 J = 1, M, 5
         WRITE (REC,FMT=99997) (F(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  100 CONTINUE
      RETURN
  120 WRITE (REC,FMT=99994)
      CALL X04BAF(NADV,REC(1))
      DO 140 J = 1, M, 5
         WRITE (REC,FMT=99997) (P(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  140 CONTINUE
      WRITE (REC,FMT=99993) PNORM
      DO 160 J = 1, 2
         CALL X04BAF(NADV,REC(J))
  160 CONTINUE
      DO 180 J = 1, M, 5
         WRITE (REC,FMT=99997) (F(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  180 CONTINUE
      IF (ICASE.NE.1) RETURN
      WRITE (REC,FMT=99992)
      CALL X04BAF(NADV,REC(1))
      DO 200 J = 1, M, 5
         WRITE (REC,FMT=99997) (D(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  200 CONTINUE
      RETURN
  220 IF (ISTATE.EQ.6) GO TO 320
      IF (ICASE.LE.2) THEN
         WRITE (REC,FMT=99988) ISTATE, IFLAG
         CALL X04BAF(NADV,REC(1))
      END IF
      WRITE (REC,FMT=99996)
      CALL X04BAF(NADV,REC(1))
      DO 240 J = 1, M, 5
         WRITE (REC,FMT=99997) (P(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  240 CONTINUE
      WRITE (REC,FMT=99987) PNORM, PNORM1
      DO 260 J = 1, 2
         CALL X04BAF(NADV,REC(J))
  260 CONTINUE
      DO 280 J = 1, M, 5
         WRITE (REC,FMT=99997) (F(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  280 CONTINUE
      IF (ICASE.NE.1) RETURN
      WRITE (REC,FMT=99992)
      CALL X04BAF(NADV,REC(1))
      DO 300 J = 1, M, 5
         WRITE (REC,FMT=99997) (D(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  300 CONTINUE
      WRITE (REC,FMT=99990) EPS
      CALL X04BAF(NADV,REC(1))
      RETURN
  320 WRITE (REC,FMT=99989)
      CALL X04BAF(NADV,REC(1))
      WRITE (REC,FMT=99996)
      CALL X04BAF(NADV,REC(1))
      DO 340 J = 1, M, 5
         WRITE (REC,FMT=99997) (P(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  340 CONTINUE
      WRITE (REC,FMT=99991) PNORM
      DO 360 J = 1, 2
         CALL X04BAF(NADV,REC(J))
  360 CONTINUE
      DO 380 J = 1, M, 5
         WRITE (REC,FMT=99997) (F(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  380 CONTINUE
      WRITE (REC,FMT=99992)
      CALL X04BAF(NADV,REC(1))
      DO 400 J = 1, M, 5
         WRITE (REC,FMT=99997) (D(I),I=J,MIN(M,J+4))
         CALL X04BAF(NADV,REC(1))
  400 CONTINUE
      WRITE (REC,FMT=99990) EPS
      CALL X04BAF(NADV,REC(1))
      RETURN
C
99999 FORMAT ('   ISTATE = ',I2,'  IFAIL1 = ',I2,'  IFLAG = ',I2)
99998 FORMAT ('  INTERNAL ERROR EXIT')
99997 FORMAT (2X,1P,5D14.6)
99996 FORMAT ('  CURRENT PARAMETERS ARE')
99995 FORMAT ('  INITIAL RESIDUALS ARE')
99994 FORMAT ('  INITIAL PARAMETERS ARE')
99993 FORMAT ('  INITIAL NORM = ',1P,D14.6,/'  INITIAL RESIDUALS ARE')
99992 FORMAT ('  SINGULAR VALUES ARE')
99991 FORMAT ('  BASIC NORM = ',1P,D14.6,/'  RESIDUALS ARE')
99990 FORMAT ('  SINGULAR VALUE PERTURBATION FACTOR = ',1P,D12.4)
99989 FORMAT ('  RECALCULATION OF SVD')
99988 FORMAT ('  STEP WITH ISTATE = ',I2,'  AND IFLAG = ',I2)
99987 FORMAT ('  BASIC NORM = ',1P,D14.6,'  CURRENT NORM = ',D14.6,
     *  /'  CURRENT RESIDUALS ARE')
99986 FORMAT (' D02SAF MONITORING INFORMATION')
99985 FORMAT (' D02HBF MONITORING INFORMATION')
99984 FORMAT (' D02HAF MONITORING INFORMATION')
      END
