      SUBROUTINE D01BAW(A,B,ITYPE,NPTS,WEIGHT,ABSCIS,IFAIL)
C     MARK 7 RELEASE. NAG COPYRIGHT 1978.
C     MARK 11.5(F77) REVISED. (SEPT 1985.)
C     MARK 13 REVISED. USE OF MARK 12 X02 FUNCTIONS (APR 1988).
C
C     RETURNS WEIGHTS AND PIVOTS FOR ONE GAUSS-HERMITE FORMULA IF
C     STORED
C     IFAIL = 1 - THE NPTS RULE IS NOT AMONG THOSE STORED
C     ( WEIGHT,ABSCIS EVALUATED FOR LARGEST VALID NPTS LESS THAN
C     REQUESTED VALUE)
C     IFAIL = 2 - B IS NOT POSITIVE
C     ( ALL WEIGHTS AND ABSCISSAE RETURNED AS ZERO)
C     IFAIL = 3 - UNDERFLOW IN EVALUATING NORMAL WEIGHTS
C     ( UNDERFLOWING WEIGHTS RETURNED AS ZERO)
C
C     THE WEIGHTS AND ABSCISSAE RETURNED DEPEND ON A AND B.
C     THOSE STORED ARE ADJUSTED WEIGHTS AND ABSCISSAE FOR A=0,B=1
C     THOSE RETURNED FOR GENERAL (A,B) ARE RELATED TO THOSE STORED
C     BY
C     X(A,B) = X(0,1) / SQRT(B) + A
C     W(A,B) = W(0,1) / SQRT(B)                     ADJUSTED WEIGHT
C     W(A,B) = W(0,1) / SQRT(B) * EXP(-X(0,1)**2)     NORMAL WEIGHT
C
C     .. Scalar Arguments ..
      DOUBLE PRECISION  A, B
      INTEGER           IFAIL, ITYPE, NPTS
C     .. Array Arguments ..
      DOUBLE PRECISION  ABSCIS(NPTS), WEIGHT(NPTS)
C     .. Local Scalars ..
      DOUBLE PRECISION  ACON, BCON, EXPMIN, EXPNOW
      INTEGER           I, IIJJ, N, NL, NN, NPTSA
C     .. Local Arrays ..
      DOUBLE PRECISION  ABST(136), WTST(136)
      INTEGER           NSTOR(16)
C     .. External Functions ..
      DOUBLE PRECISION  X02AMF
      EXTERNAL          X02AMF
C     .. Intrinsic Functions ..
      INTRINSIC         LOG, EXP, SQRT
C     .. Data statements ..
      DATA              WTST(1), WTST(2), WTST(3), WTST(4),
     *                  WTST(5)/0.177245385090551602729816748334D1,
     *                  0.146114118266113893227081153805D1,
     *                  0.132393117521364417982145369574D1,
     *                  0.118163590060367735153211165556D1,
     *                  0.124022581769581582313602133630D1/
      DATA              WTST(6), WTST(7), WTST(8), WTST(9),
     *                  WTST(10)/0.105996448289496919467700082632D1,
     *                  0.118148862553598760450064257103D1,
     *                  0.986580996751428170493791000893D0,
     *                  0.945308720482941881225689324448D0,
     *                  0.113690833267452455023236790713D1/
      DATA              WTST(11), WTST(12), WTST(13), WTST(14),
     *                  WTST(15)/0.935580557631180516030739597771D0,
     *                  0.876401334436230560398288584873D0,
     *                  0.107193014424797975646401548286D1,
     *                  0.866752606563381222217794517844D0,
     *                  0.792890048386401250905646706509D0/
      DATA              WTST(16), WTST(17), WTST(18), WTST(19),
     *                  WTST(20)/0.764544128651729199071391485062D0,
     *                  0.102545169136573723302060214399D1,
     *                  0.820666126404816614571910879903D0,
     *                  0.741441931943564970082047701889D0,
     *                  0.703296323104906170098341726820D0/
      DATA              WTST(21), WTST(22), WTST(23), WTST(24),
     *                  WTST(25)/0.687081853951273362686567184226D0,
     *                  0.989699047092298099365013260061D0,
     *                  0.786643939463322464491538074354D0,
     *                  0.705220366112219755755671548199D0,
     *                  0.662662773266871319239255150461D0/
      DATA              WTST(26), WTST(27), WTST(28), WTST(29),
     *                  WTST(30)/0.639621232020256600669349916231D0,
     *                  0.629307874369492821035718831851D0,
     *                  0.960878703025659256530957856273D0,
     *                  0.759987087397566080063276151314D0,
     *                  0.677706759192397010397799872260D0/
      DATA              WTST(31), WTST(32), WTST(33), WTST(34),
     *                  WTST(35)/0.632900606472333090829237871000D0,
     *                  0.606379739126097487205260334359D0,
     *                  0.591106667043162424830256106168D0,
     *                  0.584061690521996239000758325930D0,
     *                  0.936874492884069357470004849342D0/
      DATA              WTST(36), WTST(37), WTST(38), WTST(39),
     *                  WTST(40)/0.738245622277681359882790450735D0,
     *                  0.655755672876117706470598922177D0,
     *                  0.609736958255997285624299714816D0,
     *                  0.581247275400863892026244221842D0,
     *                  0.563217829088199837712368695264D0/
      DATA              WTST(41), WTST(42), WTST(43), WTST(44),
     *                  WTST(45)/0.552441957367459390415739574435D0,
     *                  0.547375205037843999281961634810D0,
     *                  0.898591961453191416420545454828D0,
     *                  0.704332961176942408713820400283D0,
     *                  0.622278696191412280649317396569D0/
      DATA              WTST(46), WTST(47), WTST(48), WTST(49),
     *                  WTST(50)/0.575262442852503182139156253731D0,
     *                  0.544851742364520005199359051276D0,
     *                  0.524080350948557612676557263766D0,
     *                  0.509679027117458006672866659919D0,
     *                  0.499920871336290517264977963932D0/
      DATA              WTST(51), WTST(52), WTST(53), WTST(54),
     *                  WTST(55)/0.493843385272052927814608991998D0,
     *                  0.490921500666745824279594295608D0,
     *                  0.868875565091689911673293675820D0,
     *                  0.678574662290107339978535617442D0,
     *                  0.597391700440043782447148863489D0/
      DATA              WTST(56), WTST(57), WTST(58), WTST(59),
     *                  WTST(60)/0.550207547397842546030013376905D0,
     *                  0.519043867583032989632271181604D0,
     *                  0.497076692865752223545562843831D0,
     *                  0.481072202833053294709260045854D0,
     *                  0.469284885626489034198810456724D0/
      DATA              WTST(61), WTST(62), WTST(63), WTST(64),
     *                  WTST(65)/0.460693909629746785985665099229D0,
     *                  0.454675477135121353867147656635D0,
     *                  0.450846100819996514865756523030D0,
     *                  0.448982845326226109726265246095D0,
     *                  0.824566523065655139056305722524D0/
      DATA              WTST(66), WTST(67), WTST(68), WTST(69),
     *                  WTST(70)/0.640950485913829309224087772673D0,
     *                  0.561749014649764782398926913003D0,
     *                  0.515037284667146647430741671573D0,
     *                  0.483571440736107139445169061833D0,
     *                  0.460786455690955139026733402184D0/
      DATA              WTST(71), WTST(72), WTST(73), WTST(74),
     *                  WTST(75)/0.443553185501410843028238668408D0,
     *                  0.430163710880612661826154332952D0,
     *                  0.419597753081150804947789020760D0,
     *                  0.411206128712310155343092650551D0,
     *                  0.404557061796617160693998299314D0/
      DATA              WTST(76), WTST(77), WTST(78), WTST(79),
     *                  WTST(80)/0.399354844618449389544597768000D0,
     *                  0.395393939396172377687363613476D0,
     *                  0.392531864365819903660931165803D0,
     *                  0.390672744628543125976647215992D0,
     *                  0.389757342027438731932682765057D0/
      DATA              WTST(81), WTST(82), WTST(83), WTST(84),
     *                  WTST(85)/0.766876368495238274746411051044D0,
     *                  0.593128455631209585878126597175D0,
     *                  0.517445935842046958048825686801D0,
     *                  0.472277449549521321867721596361D0,
     *                  0.441405136853915738519768767287D0/
      DATA              WTST(86), WTST(87), WTST(88), WTST(89),
     *                  WTST(90)/0.418643762410651395960265975190D0,
     *                  0.401037665458882553379674293048D0,
     *                  0.386967139217075008041181017180D0,
     *                  0.375458352846498342591218999274D0,
     *                  0.365885220494083772716610708913D0/
      DATA              WTST(91), WTST(92), WTST(93), WTST(94),
     *                  WTST(95)/0.357824345486808042028607717718D0,
     *                  0.350977930538897867605721029693D0,
     *                  0.345129911413373110866703372437D0,
     *                  0.340119598454938889487779018765D0,
     *                  0.335825120387576070820832052751D0/
      DATA              WTST(96), WTST(97), WTST(98), WTST(99),
     *                  WTST(100)/0.332152637910123377750889027753D0,
     *                  0.329029100292743088147440929506D0,
     *                  0.326397258658636261497700089513D0,
     *                  0.324212164105044746879770317833D0,
     *                  0.322438672438255669417772078051D0/
      DATA              WTST(101), WTST(102), WTST(103), WTST(104),
     *                  WTST(105)/0.321049651285514786202103413506D0,
     *                  0.320024692056773847195880277680D0,
     *                  0.319349196902419087447733515776D0,
     *                  0.319013755285312385825621915982D0,
     *                  0.728927208690448427742110375683D0/
      DATA              WTST(106), WTST(107), WTST(108), WTST(109),
     *                  WTST(110)/0.562255561656448726802887082512D0,
     *                  0.489326444740731915235376894508D0,
     *                  0.445579328497246221345783916011D0,
     *                  0.415503913204160831669677232455D0,
     *                  0.393180736318882184851902579711D0/
      DATA              WTST(111), WTST(112), WTST(113), WTST(114),
     *                  WTST(115)/0.375778926542059581956812824873D0,
     *                  0.361745661531460261101060426381D0,
     *                  0.350146138450335332748577866176D0,
     *                  0.340378325558398342073645322743D0,
     *                  0.332034121660959831597172057861D0/
      DATA              WTST(116), WTST(117), WTST(118), WTST(119),
     *                  WTST(120)/0.324825535546719088610765834044D0,
     *                  0.318542654113848743235199368676D0,
     *                  0.313028363535617904475039006475D0,
     *                  0.308162449185309597110102248845D0,
     *                  0.303851213837657558658155179366D0/
      DATA              WTST(121), WTST(122), WTST(123), WTST(124),
     *                  WTST(125)/0.300020481151580296697435447362D0,
     *                  0.296610751157979998401894795218D0,
     *                  0.293573766485027313963221076049D0,
     *                  0.290870028592030296329129560635D0,
     *                  0.288466969153227589575235356344D0/
      DATA              WTST(126), WTST(127), WTST(128), WTST(129),
     *                  WTST(130)/0.286337582975828641347074702920D0,
     *                  0.284459392399569721310680757112D0,
     *                  0.282813654050477159948319322829D0,
     *                  0.281384745779077791730100909906D0,
     *                  0.280159689744734105675726026292D0/
      DATA              WTST(131), WTST(132), WTST(133), WTST(134),
     *                  WTST(135)/0.279127780042487258712648370028D0,
     *                  0.278280291956949764070907305894D0,
     *                  0.277610256111740156146566249797D0,
     *                  0.277112285270899476074163167412D0,
     *                  0.276782444877604386788636614272D0/
      DATA              WTST(136)/0.276618160950139556162846622036D0/
      DATA              ABST(1), ABST(2), ABST(3), ABST(4),
     *                  ABST(5)/0.000000000000000000000000000000D0,
     *                  0.707106781186547524400844362104D0,
     *                  0.122474487139158904909864203735D+1,
     *                  0.000000000000000000000000000000D0,
     *                  0.165068012388578455588334111112D+1/
      DATA              ABST(6), ABST(7), ABST(8), ABST(9),
     *                  ABST(10)/0.524647623275290317884060253834D0,
     *                  0.202018287045608563292872408814D+1,
     *                  0.958572464613818507112770593892D0,
     *                  0.000000000000000000000000000000D0,
     *                  0.235060497367449222283392198706D+1/
      DATA              ABST(11), ABST(12), ABST(13), ABST(14),
     *                  ABST(15)/0.133584907401369694971489528297D+1,
     *                  0.436077411927616508679215948250D0,
     *                  0.293063742025724401922350270524D+1,
     *                  0.198165675669584292585463063976D+1,
     *                  0.115719371244678019472076577906D+1/
      DATA              ABST(16), ABST(17), ABST(18), ABST(19),
     *                  ABST(20)/0.381186990207322116854718885583D0,
     *                  0.343615911883773760332672549431D+1,
     *                  0.253273167423278979640896079775D+1,
     *                  0.175668364929988177345140122010D+1,
     *                  0.103661082978951365417749191675D+1/
      DATA              ABST(21), ABST(22), ABST(23), ABST(24),
     *                  ABST(25)/0.342901327223704608789165025557D0,
     *                  0.388972489786978191927164274724D+1,
     *                  0.302063702512088977171067937517D+1,
     *                  0.227950708050105990018772856942D+1,
     *                  0.159768263515260479670966277090D+1/
      DATA              ABST(26), ABST(27), ABST(28), ABST(29),
     *                  ABST(30)/0.947788391240163743704578131060D0,
     *                  0.314240376254359111276611634095D0,
     *                  0.430444857047363181262129810036D+1,
     *                  0.346265693360227055020891736115D+1,
     *                  0.274847072498540256862499852414D+1/
      DATA              ABST(31), ABST(32), ABST(33), ABST(34),
     *                  ABST(35)/0.209518325850771681573497272630D+1,
     *                  0.147668273114114087058350654420D+1,
     *                  0.878713787329399416114679311860D0,
     *                  0.291745510672562078446113075799D0,
     *                  0.468873893930581836468849864874D+1/
      DATA              ABST(36), ABST(37), ABST(38), ABST(39),
     *                  ABST(40)/0.386944790486012269871942409801D+1,
     *                  0.317699916197995602681399455926D+1,
     *                  0.254620215784748136215932870544D+1,
     *                  0.195178799091625397743465541495D+1,
     *                  0.138025853919888079637208966969D+1/
      DATA              ABST(41), ABST(42), ABST(43), ABST(44),
     *                  ABST(45)/0.822951449144655892582454496733D0,
     *                  0.273481046138152452158280401965D0,
     *                  0.538748089001123286201690041068D+1,
     *                  0.460368244955074427307767524897D+1,
     *                  0.394476404011562521037562880052D+1/
      DATA              ABST(46), ABST(47), ABST(48), ABST(49),
     *                  ABST(50)/0.334785456738321632691492452299D+1,
     *                  0.278880605842813048052503375640D+1,
     *                  0.225497400208927552308233334473D+1,
     *                  0.173853771211658620678086566213D+1,
     *                  0.123407621539532300788581834695D+1/
      DATA              ABST(51), ABST(52), ABST(53), ABST(54),
     *                  ABST(55)/0.737473728545394358705605144252D0,
     *                  0.245340708300901249903836530633D0,
     *                  0.601592556142573971734857350898D+1,
     *                  0.525938292766804436743072304398D+1,
     *                  0.462566275642378726504864923776D+1/
      DATA              ABST(56), ABST(57), ABST(58), ABST(59),
     *                  ABST(60)/0.405366440244814950394766297923D+1,
     *                  0.352000681303452471128987227608D+1,
     *                  0.301254613756556482565453858420D+1,
     *                  0.252388101701142697419907602332D+1,
     *                  0.204900357366169891178708399532D+1/
      DATA              ABST(61), ABST(62), ABST(63), ABST(64),
     *                  ABST(65)/0.158425001096169414850563336201D+1,
     *                  0.112676081761124507213306126773D+1,
     *                  0.674171107037212236000245923730D0,
     *                  0.224414547472515585151136715526D0,
     *                  0.712581390983072757279520760342D+1/
      DATA              ABST(66), ABST(67), ABST(68), ABST(69),
     *                  ABST(70)/0.640949814926966041217376374152D+1,
     *                  0.581222594951591383276596615365D+1,
     *                  0.527555098651588012781906048139D+1,
     *                  0.477716450350259639303579405688D+1,
     *                  0.430554795335119844526348653193D+1/
      DATA              ABST(71), ABST(72), ABST(73), ABST(74),
     *                  ABST(75)/0.385375548547144464388787292109D+1,
     *                  0.341716749281857073587392729563D+1,
     *                  0.299249082500237420628549407606D+1,
     *                  0.257724953773231745403092930114D+1,
     *                  0.216949918360611217330570559501D+1/
      DATA              ABST(76), ABST(77), ABST(78), ABST(79),
     *                  ABST(80)/0.176765410946320160462767325852D+1,
     *                  0.137037641095287183816170564864D+1,
     *                  0.976500463589682838484704871981D0,
     *                  0.584978765435932448466957544011D0,
     *                  0.194840741569399326708741289532D0/
      DATA              ABST(81), ABST(82), ABST(83), ABST(84),
     *                  ABST(85)/0.897531508193168706215358223476D+1,
     *                  0.831075219070478413034784782669D+1,
     *                  0.775929551976577463923770264126D+1,
     *                  0.726604655416435040282062777182D+1,
     *                  0.681006457807414138661792830623D+1/
      DATA              ABST(86), ABST(87), ABST(88), ABST(89),
     *                  ABST(90)/0.638056409618641062386710795477D+1,
     *                  0.597107222501354540770712331894D+1,
     *                  0.557731698122372862626895168708D+1,
     *                  0.519628771879236454097986825550D+1,
     *                  0.482575722813320948395976669771D+1/
      DATA              ABST(91), ABST(92), ABST(93), ABST(94),
     *                  ABST(95)/0.446401454693445890384147501245D+1,
     *                  0.410970460356059023650054924395D+1,
     *                  0.376172649022835778750118455640D+1,
     *                  0.341916596936388461135547839398D+1,
     *                  0.308124898864510584970840484975D+1/
      DATA              ABST(96), ABST(97), ABST(98), ABST(99),
     *                  ABST(100)/0.274730862482238321948145392074D+1,
     *                  0.241676090487321645904643205900D+1,
     *                  0.208908666094427643599567785405D+1,
     *                  0.176381757989530000622984196672D+1,
     *                  0.144052522013756518650995755277D+1/
      DATA              ABST(101), ABST(102), ABST(103), ABST(104),
     *                  ABST(105)/0.111881215240215656333400026648D+1,
     *                  0.798304627778562231219097373434D0,
     *                  0.478646337594496098233148980979D0,
     *                  0.159492935848862470507111125726D0,
     *                  0.105261231679605458833268262838D+2/
      DATA              ABST(106), ABST(107), ABST(108), ABST(109),
     *                  ABST(110)/0.989528758682953902120446147715D+1,
     *                  0.937315954964672116254565243972D+1,
     *                  0.890724909996476975729597288564D+1,
     *                  0.847752908337986309056416634482D+1,
     *                  0.807368728501022522585879114075D+1/
      DATA              ABST(111), ABST(112), ABST(113), ABST(114),
     *                  ABST(115)/0.768954016404049682844780422986D+1,
     *                  0.732101303278094920118956936371D+1,
     *                  0.696524112055110752924264219349D+1,
     *                  0.662011226263602737903666010893D+1,
     *                  0.628401122877482823541809319507D+1/
      DATA              ABST(116), ABST(117), ABST(118), ABST(119),
     *                  ABST(120)/0.595566632679948604534456718098D+1,
     *                  0.563405216434997214724992048330D+1,
     *                  0.531832522463327085732364951519D+1,
     *                  0.500777960219876819644370262718D+1,
     *                  0.470181564740749981609753801581D+1/
      DATA              ABST(121), ABST(122), ABST(123), ABST(124),
     *                  ABST(125)/0.439991716822813764776793253543D+1,
     *                  0.410163447456665671497098123845D+1,
     *                  0.380657151394536046116597200046D+1,
     *                  0.351437593574090621153995058647D+1,
     *                  0.322473129199203572584817111018D+1/
      DATA              ABST(126), ABST(127), ABST(128), ABST(129),
     *                  ABST(130)/0.293735082300462180968533902619D+1,
     *                  0.265197243543063501100545778599D+1,
     *                  0.236835458863240140411151126534D+1,
     *                  0.208627287988176202083256330236D+1,
     *                  0.180551717146554491890377357418D+1/
      DATA              ABST(131), ABST(132), ABST(133), ABST(134),
     *                  ABST(135)/0.152588914020986366294897013315D+1,
     *                  0.124720015694311794069356453069D+1,
     *                  0.969269423071178016743541489019D0,
     *                  0.691922305810044577268219287595D0,
     *                  0.414988824121078684576929129199D0/
      DATA              ABST(136)/0.138302244987009724115049767966D0/
      DATA              NSTOR(1), NSTOR(2), NSTOR(3), NSTOR(4)/1, 2, 3,
     *                  4/
      DATA              NSTOR(5), NSTOR(6), NSTOR(7), NSTOR(8)/5, 6, 8,
     *                  10/
      DATA              NSTOR(9), NSTOR(10), NSTOR(11), NSTOR(12)/12,
     *                  14, 16, 20/
      DATA              NSTOR(13), NSTOR(14), NSTOR(15), NSTOR(16)/24,
     *                  32, 48, 64/
C     .. Executable Statements ..
      DO 20 I = 1, NPTS
         WEIGHT(I) = 0.0D0
         ABSCIS(I) = 0.0D0
   20 CONTINUE
      IF (B.GT.0.0D0) GO TO 40
      IFAIL = 2
      RETURN
   40 N = 0
      NPTSA = 0
      IFAIL = 0
      DO 60 I = 1, 16
         IF (NPTS.LT.NSTOR(I)) GO TO 80
         N = N + (NPTSA+1)/2
         NPTSA = NSTOR(I)
         IF (NPTS.EQ.NSTOR(I)) GO TO 100
   60 CONTINUE
   80 IFAIL = 1
  100 ACON = A
      BCON = SQRT(B)
      NL = NPTSA/2
      IF (NL.LT.1) GO TO 140
      DO 120 NN = 1, NL
         N = N + 1
         IIJJ = NPTSA + 1 - NN
         ABSCIS(NN) = ABST(N)/BCON + ACON
         WEIGHT(NN) = WTST(N)/BCON
         ABSCIS(IIJJ) = -ABST(N)/BCON + ACON
         WEIGHT(IIJJ) = WTST(N)/BCON
  120 CONTINUE
  140 IF (NPTSA.LE.(NL+NL)) GO TO 160
      N = N + 1
      ABSCIS(NL+1) = ABST(N)/BCON + ACON
      WEIGHT(NL+1) = WTST(N)/BCON
  160 IF (ITYPE.EQ.1) GO TO 220
      EXPMIN = LOG(X02AMF())
      DO 200 N = 1, NPTSA
         EXPNOW = -B*(ABSCIS(N)-A)**2 + LOG(WEIGHT(N))
         IF (EXPNOW.LT.EXPMIN) GO TO 180
         WEIGHT(N) = EXP(EXPNOW)
         GO TO 200
  180    IFAIL = 3
         WEIGHT(N) = 0.0D0
  200 CONTINUE
  220 RETURN
      END
