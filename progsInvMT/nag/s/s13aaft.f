      DOUBLE PRECISION FUNCTION S13AAF(X,IFAIL)
C     MARK 5A REVISED - NAG COPYRIGHT 1976
C     MARK 11.5(F77) REVISED. (SEPT 1985.)
C     MARK 14 REVISED. IER-751 (DEC 1989).
C     MARK 16 RE-ISSUE. NAG COPYRIGHT 1993.
C     EXPONENTIAL INTEGRAL E1(X)
C
C     **************************************************************
C
C     TO EXTRACT THE CORRECT CODE FOR A PARTICULAR MACHINE-RANGE,
C     ACTIVATE THE STATEMENTS CONTAINED IN COMMENTS BEGINNING  CDD ,
C     WHERE  DD  IS THE APPROXIMATE NUMBER OF SIGNIFICANT DECIMAL
C     DIGITS REPRESENTED BY THE MACHINE
C     DELETE THE ILLEGAL DUMMY STATEMENTS OF THE FORM
C     * EXPANSION (NNNN) *
C
C     ALSO INSERT APPROPRIATE DATA STATEMENTS TO DEFINE CONSTANTS
C     WHICH DEPEND ON THE RANGE OF NUMBERS REPRESENTED BY THE
C     MACHINE, RATHER THAN THE PRECISION (SUITABLE STATEMENTS FOR
C     SOME MACHINES ARE CONTAINED IN COMMENTS BEGINNING CRD WHERE
C     D IS A DIGIT WHICH SIMPLY DISTINGUISHES A GROUP OF MACHINES).
C     DELETE THE ILLEGAL DUMMY DATA STATEMENTS WITH VALUES WRITTEN
C     *VALUE*
C
C     **************************************************************
C     .. Parameters ..
      CHARACTER*6                      SRNAME
      PARAMETER                        (SRNAME='S13AAF')
C     .. Scalar Arguments ..
      DOUBLE PRECISION                 X
      INTEGER                          IFAIL
C     .. Local Scalars ..
      DOUBLE PRECISION                 T, XHI, Y
C     .. Local Arrays ..
      CHARACTER                        P01REC(1)
C     .. External Functions ..
      INTEGER                          P01ABF
      EXTERNAL                         P01ABF
C     .. Intrinsic Functions ..
      INTRINSIC                        EXP, LOG
C     .. Executable Statements ..
C     RANGE DEPENDENT CONSTANTS
C     XHI ---- * MAXIMUM NEGATIVE ARGUMENT FOR EXP *
      DATA XHI/ 7.083D+2/
C
CR1   DATA XHI/167.0D0/
CR2   DATA XHI/85.0D0/
CR3   DATA XHI/167.0D0/
CR4   DATA XHI/668.0D0/
CR5   DATA XHI/702.0D0/
C
C     ERROR TEST
      IF (X.LE.0.0D0) GO TO 60
      IFAIL = 0
C
C     LARGE RANGE TEST
      IF (X.GT.4.0D0) GO TO 20
C
C     SMALL X - ARGUMENT EVALUATION
C
C     Modified by MWP, September 1989.
C     The argument range 0.0 .. 4.0 has been split into the three ranges
C     0.0 .. 1.0, 1.0 .. 2.0 and 2.0 .. 4.0. New Chebyshev expansions
C     have been generated for the three ranges, to avoid the large
C     (approximately 9 trailing bits) error in the original as the
C     argument approaches 4.0, discovered by J. Cody's test program for
C     the Ei function.
C
      IF (X.LE.1.0D0) THEN
         T = 2.0D0*X - 1.0D0
C
C       Precision 8 sig. figs.
C08     Y = (((((((
C08  *   +1.440583819D-07)*T -2.376420291D-06)*T
C08  *   +3.442247941D-05)*T -4.378958806D-04)*T
C08  *   +4.795892835D-03)*T -4.510200717D-02)*T
C08  *   +3.934693403D-01)*T -1.333735857D-01
C
C       Precision 12 sig. figs.
C12     Y = (((((((((
C12  *   +3.8366097913244D-10)*T -7.8174660142639D-09)*T
C12  *   +1.4319514474111D-07)*T -2.3607853588679D-06)*T
C12  *   +3.4423126840862D-05)*T -4.3790565248140D-04)*T
C12  *   +4.7958926555051D-03)*T -4.5102005213848D-02)*T
C12  *   +3.9346934028737D-01)*T -1.3337358578382D-01
C
C       Precision 14 sig. figs.
C14     Y = (((((((((((
C14  *   +7.068015128480379D-13)*T -1.717724642247279D-11)*T
C14  *   +3.817172749721100D-10)*T -7.774522898207751D-09)*T
C14  *   +1.431970884452694D-07)*T -2.360822934094487D-06)*T
C14  *   +3.442312599049166D-05)*T -4.379056390616791D-04)*T
C14  *   +4.795892655656980D-03)*T -4.510200521552588D-02)*T
C14  *   +3.934693402873666D-01)*T -1.333735857837845D-01
C
C       Precision 16 sig. figs.
        Y = ((((((((((((
     *   -2.68991715725239147D-14)*T +7.06801512848037888D-13)*T
     *   -1.70965489077552146D-11)*T +3.81717274972110040D-10)*T
     *   -7.77461368291180797D-09)*T +1.43197088445269424D-07)*T
     *   -2.36082288702093691D-06)*T +3.44231259904916577D-05)*T
     *   -4.37905639072711938D-04)*T +4.79589265565698012D-03)*T
     *   -4.51020052155249319D-02)*T +3.93469340287366573D-01)*T
     *   -1.33373585783784498D-01
C
C       Precision 18 sig. figs.
C18     Y = (((((((((((((
C18  *   +9.5206483359069313961D-16)*T -2.6899171572523914700D-14)*T
C18  *   +7.0370730213886813579D-13)*T -1.7096548907755214565D-11)*T
C18  *   +3.8172114273549650237D-10)*T -7.7746136829118079725D-09)*T
C18  *   +1.4319708612461139221D-07)*T -2.3608228870209369100D-06)*T
C18  *   +3.4423125991168516277D-05)*T -4.3790563907271193795D-04)*T
C18  *   +4.7958926556568955145D-03)*T -4.5102005215524931921D-02)*T
C18  *   +3.9346934028736657640D-01)*T -1.3337358578378449767D-01
C
         S13AAF = Y - LOG(X)
      ELSE IF (X.LE.2.0D0) THEN
         T = 2.0D0*X - 3.0D0
C
C       Precision 8 sig. figs.
C08     S13AAF = (((((((((((
C08  *   -7.061094354D-07)*T +2.263523003D-06)*T
C08  *   -5.387385869D-06)*T +1.836712798D-05)*T
C08  *   -6.542020177D-05)*T +2.279693235D-04)*T
C08  *   -8.077089409D-04)*T +2.883732596D-03)*T
C08  *   -9.985769356D-03)*T +3.099030757D-02)*T
C08  *   -7.437671983D-02)*T +1.000195823D-01
C
C       Precision 12 sig. figs.
C12     S13AAF = ((((((((((((((((
C12  *   +2.3096066277969D-09)*T -7.1793994220213D-09)*T
C12  *   +1.3178326869023D-08)*T -4.3429628301566D-08)*T
C12  *   +1.5866079943042D-07)*T -5.1784833471977D-07)*T
C12  *   +1.6923798124315D-06)*T -5.6423434147588D-06)*T
C12  *   +1.9049138566972D-05)*T -6.5261337890227D-05)*T
C12  *   +2.2760486480728D-04)*T -8.0775630682817D-04)*T
C12  *   +2.8838195929088D-03)*T -9.9857633489336D-03)*T
C12  *   +3.0990300020326D-02)*T -7.4376720049289D-02)*T
C12  *   +1.0001958240663D-01
C
C       Precision 14 sig. figs.
C14     S13AAF = ((((((((((((((((((
C14  *   +2.417367865658587D-10)*T -7.459121879305924D-10)*T
C14  *   +1.221791088250545D-09)*T -4.009272623316330D-09)*T
C14  *   +1.521798100567208D-08)*T -4.897735019929973D-08)*T
C14  *   +1.565984824700350D-07)*T -5.126968786718792D-07)*T
C14  *   +1.693595106354590D-06)*T -5.645067742476413D-06)*T
C14  *   +1.904871788830617D-05)*T -6.526052059191176D-05)*T
C14  *   +2.276049466059132D-04)*T -8.077564368529011D-04)*T
C14  *   +2.883819584941398D-03)*T -9.985763339646155D-03)*T
C14  *   +3.099030002062472D-02)*T -7.437672004948214D-02)*T
C14  *   +1.000195824066326D-01
C
C       Precision 16 sig. figs.
        S13AAF = (((((((((((((((((((((
     *   -8.37205032055466094D-12)*T +2.56178397184819264D-11)*T
     *   -3.46318473395090883D-11)*T +1.13647587973449109D-10)*T
     *   -4.71527752610644265D-10)*T +1.49398063525941572D-09)*T
     *   -4.63129693426107937D-09)*T +1.48977580091910592D-08)*T
     *   -4.82569495402871907D-08)*T +1.56826141006595685D-07)*T
     *   -5.13180763112114830D-07)*T +1.69349493659850299D-06)*T
     *   -5.64487355301463818D-06)*T +1.90487447194908340D-05)*T
     *   -6.52605660793704808D-05)*T +2.27604942478038604D-04)*T
     *   -8.07756431103733780D-04)*T +2.88381958526388800D-03)*T
     *   -9.98576333997560656D-03)*T +3.09903000206149474D-02)*T
     *   -7.43767200494766144D-02)*T +1.00019582406632653D-01
C
C       Precision 18 sig. figs.
C18     S13AAF = (((((((((((((((((((((((
C18  *   -9.0007881252388207391D-13)*T +2.7422501500554572384D-12)*T
C18  *   -3.1965971485423390195D-12)*T +1.0535463893176911586D-11)*T
C18  *   -4.7570480269539893139D-11)*T +1.4946823055854851869D-10)*T
C18  *   -4.5309020068535036827D-10)*T +1.4459055623162559871D-09)*T
C18  *   -4.6477936912468686460D-09)*T +1.4937820569977025642D-08)*T
C18  *   -4.8247326432045480305D-08)*T +1.5680469575346907931D-07)*T
C18  *   -5.1318444253585430703D-07)*T +1.6935023084042652605D-06)*T
C18  *   -5.6448726495847021456D-06)*T +1.9048743139818170609D-05)*T
C18  *   -6.5260566214884971187D-05)*T +2.2760494267549768731D-04)*T
C18  *   -8.0775643109244090629D-04)*T +2.8838195852512303647D-03)*T
C18  *   -9.9857633399760409035D-03)*T +3.0990300020615263866D-02)*T
C18  *   -7.4376720049476609503D-02)*T +1.0001958240663265187D-01
C
      ELSE
         T = X - 3.0D0
C
C       Precision 8 sig. figs.
C08     S13AAF = (((((((((((
C08  *   -7.059571442D-07)*T +2.261629029D-06)*T
C08  *   -5.366077635D-06)*T +1.814359243D-05)*T
C08  *   -6.329187380D-05)*T +2.098024172D-04)*T
C08  *   -6.709510655D-04)*T +1.997542301D-03)*T
C08  *   -5.224574918D-03)*T +1.106380052D-02)*T
C08  *   -1.659568924D-02)*T +1.304838099D-02
C
C       Precision 12 sig. figs.
C12     S13AAF = ((((((((((((((((
C12  *   +2.3096064453358D-09)*T -7.1793962655365D-09)*T
C12  *   +1.3178276081780D-08)*T -4.3428849590904D-08)*T
C12  *   +1.5864961624877D-07)*T -5.1769859501649D-07)*T
C12  *   +1.6905196782589D-06)*T -5.6210319828069D-06)*T
C12  *   +1.8825564833404D-05)*T -6.3133011847018D-05)*T
C12  *   +2.0943797837472D-04)*T -6.7099843089888D-04)*T
C12  *   +1.9976292940220D-03)*T -5.2245689117581D-03)*T
C12  *   +1.1063792970347D-02)*T -1.6595689455767D-02)*T
C12  *   +1.3048381094199D-02
C
C       Precision 14 sig. figs.
C14     S13AAF = ((((((((((((((((((
C14  *   +2.417367860477164D-10)*T -7.459121779493645D-10)*T
C14  *   +1.221790908121114D-09)*T -4.009269509251664D-09)*T
C14  *   +1.521793021405771D-08)*T -4.897657141440262D-08)*T
C14  *   +1.565872992927983D-07)*T -5.125471390375255D-07)*T
C14  *   +1.691734972179342D-06)*T -5.623756310488058D-06)*T
C14  *   +1.882514415473873D-05)*T -6.313219454871388D-05)*T
C14  *   +2.094380601733444D-04)*T -6.709985609236111D-04)*T
C14  *   +1.997629286054612D-03)*T -5.224568902470666D-03)*T
C14  *   +1.106379297064590D-02)*T -1.659568945596018D-02)*T
C14  *   +1.304838109419699D-02
C
C       Precision 16 sig. figs.
        S13AAF = (((((((((((((((((((((
     *   -8.37205032050043424D-12)*T +2.56178397172768657D-11)*T
     *   -3.46318473142044651D-11)*T +1.13647587461332047D-10)*T
     *   -4.71527742750325071D-10)*T +1.49398045511718119D-09)*T
     *   -4.63129381995412142D-09)*T +1.48977072175917445D-08)*T
     *   -4.82561707556553537D-08)*T +1.56814957829348347D-07)*T
     *   -5.13031023477588644D-07)*T +1.69163480242326026D-06)*T
     *   -5.62356212102635108D-06)*T +1.88251709859233953D-05)*T
     *   -6.31322400361725865D-05)*T +2.09438056045469880D-04)*T
     *   -6.70998555174443855D-04)*T +1.99762928637710204D-03)*T
     *   -5.22456890280011749D-03)*T +1.10637929706361252D-02)*T
     *   -1.65956894559546525D-02)*T +1.30483810941970387D-02
C
C       Precision 18 sig. figs.
C18     S13AAF = (((((((((((((((((((((((
C18  *   -9.0007881252378504086D-13)*T +2.7422501500531212532D-12)*T
C18  *   -3.1965971484886702549D-12)*T +1.0535463891984698815D-11)*T
C18  *   -4.7570480244233875039D-11)*T +1.4946823004640094365D-10)*T
C18  *   -4.5309019082503316137D-10)*T +1.4459053821740624093D-09)*T
C18  *   -4.6477905769399089182D-09)*T +1.4937769778377676795D-08)*T
C18  *   -4.8246547647413644376D-08)*T +1.5679351257622175959D-07)*T
C18  *   -5.1303470290132812158D-07)*T +1.6916421742290225216D-06)*T
C18  *   -5.6235612175964150492D-06)*T +1.8825169406250731982D-05)*T
C18  *   -6.3132240171687076877D-05)*T +2.0943805624292896303D-04)*T
C18  *   -6.7099855516315098084D-04)*T +1.9976292863644444081D-03)*T
C18  *   -5.2245689028005518348D-03)*T +1.1063792970636441621D-02)*T
C18  *   -1.6595689455954647519D-02)*T +1.3048381094197037378D-02
C
      END IF
      RETURN
C
C     LARGE X - ASYMPTOTIC TEST
   20 IF (X.GE.XHI) GO TO 40
C
C     ARGUMENT EVALUATION
      T = 14.5D0/(X+3.25D0) - 1.0D0
C
C      * EXPANSION (0016) *
C
C     EXPANSION (0016) EVALUATED AS Y(T)  --PRECISION 08E
C08   Y = ((((((((-1.2250485D-6)*T-5.3919030D-6)*T-1.9354415D-5)
C08  *    *T-9.1125383D-5)*T-4.0594777D-4)*T-2.1422772D-3)
C08  *    *T-1.0637480D-2)*T-8.5069904D-2)*T + 9.2375531D-1
C
C     EXPANSION (0016) EVALUATED AS Y(T)  --PRECISION 12E
C12   Y = ((((((((((((-4.51645791647D-9)*T-2.08989466507D-8)
C12  *    *T-5.99732908759D-8)*T-2.64781099635D-7)
C12  *    *T-1.05648487669D-6)*T-4.72430537081D-6)
C12  *    *T-1.95073425042D-5)*T-9.16440409958D-5)
C12  *    *T-4.05892179927D-4)*T-2.14213067723D-3)
C12  *    *T-1.06374875086D-2)*T-8.50699154939D-2)*T +
C12  *     9.23755307808D-1
C
C     EXPANSION (0016) EVALUATED AS Y(T)  --PRECISION 14E
C14   Y = ((((((((((((((-2.6312960621345D-10)*T-1.4755418213853D-9)
C14  *    *T-3.5955042947258D-9)*T-1.6103435731190D-8)
C14  *    *T-6.1239602105834D-8)*T-2.7077548828395D-7)
C14  *    *T-1.0556214826693D-6)*T-4.7207087376182D-6)
C14  *    *T-1.9507644692103D-5)*T-9.1645090013774D-5)
C14  *    *T-4.0589212956260D-4)*T-2.1421305461012D-3)
C14  *    *T-1.0637487511699D-2)*T-8.5069915498563D-2)*T +
C14  *     9.2375530780778D-1
C
C     EXPANSION (0016) EVALUATED AS Y(T)  --PRECISION 16E
      Y = ((((((((((((((((-1.181683914463340D-11
     *    *T-1.048399621792147D-11)*T-6.804206766157201D-11)
     *    *T-2.211936213417643D-10)*T-1.119940934924999D-9)
     *    *T-3.663650270142246D-9)*T-1.668705862724518D-8)
     *    *T-6.118194012663569D-8)*T-2.703104833900864D-7)
     *    *T-1.055648511722045D-6)*T-4.720903675164850D-6)
     *    *T-1.950763781198026D-5)*T-9.164504841773118D-5)
     *    *T-4.058921304226172D-4)*T-2.142130549996267D-3)
     *    *T-1.063748751165807D-2)*T-8.506991549845731D-2)*T +
     *     9.237553078077841D-1
C
C     EXPANSION (0016) EVALUATED AS Y(T)  --PRECISION 18E
C18   Y = (((((((((((((((-1.62806570868460749D-12
C18  *    *T+8.95400579318284288D-13)*T-4.08352702838151578D-12)
C18  *    *T-1.45132988248537498D-11)*T-8.35086918940757852D-11)
C18  *    *T-2.13638678953766289D-10)*T-1.10302431467069770D-9)
C18  *    *T-3.67128915633455484D-9)*T-1.66980544304104726D-8)
C18  *    *T-6.11774386401295125D-8)*T-2.70306163610271497D-7)
C18  *    *T-1.05565006992891261D-6)*T-4.72090467203711484D-6)
C18  *    *T-1.95076375089955937D-5)*T-9.16450482931221453D-5)
C18  *    *T-4.05892130452128677D-4)*T-2.14213055000334718D-3
C18   Y = ((Y*T-1.06374875116569657D-2)*T-8.50699154984571871D-2)*T +
C18  *     9.23755307807784058D-1
C
C
      S13AAF = EXP(-X)*Y/X
      RETURN
C
C     ASYMPTOTIC RANGE
   40 S13AAF = 0.0D0
      RETURN
C
C     ERROR EXIT
   60 IFAIL = P01ABF(IFAIL,1,SRNAME,0,P01REC)
      S13AAF = 0.0D0
      RETURN
C
      END
