      DOUBLE PRECISION FUNCTION S20ADF(X,IFAIL)
C     MARK 7 RELEASE. NAG COPYRIGHT 1978.
C     MARK 11.5(F77) REVISED. (SEPT 1985.)
C     FRESNEL INTEGRAL C(X)
C
C     **************************************************************
C
C     TO EXTRACT THE CORRECT CODE FOR A PARTICULAR MACHINE-RANGE,
C     ACTIVATE THE STATEMENTS CONTAINED IN COMMENTS BEGINNING  CDD ,
C     WHERE  DD  IS THE APPROXIMATE NUMBER OF SIGNIFICANT DECIMAL
C     DIGITS REPRESENTED BY THE MACHINE
C     DELETE THE ILLEGAL DUMMY STATEMENTS OF THE FORM
C     * EXPANSION (NNNN) *
C
C     ALSO INSERT APPROPRIATE DATA STATEMENTS TO DEFINE CONSTANTS
C     WHICH DEPEND ON THE RANGE OF NUMBERS REPRESENTED BY THE
C     MACHINE, RATHER THAN THE PRECISION (SUITABLE STATEMENTS FOR
C     SOME MACHINES ARE CONTAINED IN COMMENTS BEGINNING CRD WHERE
C     D IS A DIGIT WHICH SIMPLY DISTINGUISHES A GROUP OF MACHINES).
C     DELETE THE ILLEGAL DUMMY DATA STATEMENTS WITH VALUES WRITTEN
C     *VALUE*
C
C     **************************************************************
C
C     .. Scalar Arguments ..
      DOUBLE PRECISION                 X
      INTEGER                          IFAIL
C     .. Local Scalars ..
      DOUBLE PRECISION                 A, B, C, F, G, S, T, TBPI, TH, U,
     *                                 XBIG, XSMALL, XVBIG, Y
      INTEGER                          K, N
C     .. Intrinsic Functions ..
      INTRINSIC                        ABS, MOD, SIGN, COS, DBLE, SIN
C     .. Data statements ..
C08   DATA TBPI,XSMALL,XBIG/
C08  A6.36619772D-1,4.4D-2,1.6D2/
C09   DATA TBPI,XSMALL,XBIG/
C09  A6.366197724D-1,1.3D-2,3.9D2/
C12   DATA TBPI,XSMALL,XBIG/
C12  A6.366197723676D-1,2.3D-3,3.9D3/
C15   DATA TBPI,XSMALL,XBIG/
C15  A6.366197723675813D-1,4.1D-4,5.0D4/
      DATA TBPI,XSMALL,XBIG/
     A6.36619772367581343D-1,1.7D-4,2.6D5/
C19   DATA TBPI,XSMALL,XBIG/
C19  A6.3661977236758134308D-1,5.1D-5,6.2D5/
      DATA XVBIG / 4.29496729D+9 /
C     XVBIG = THE SMALLEST OF THE FOLLOWING
C     1.)  BASE/(PI*MACHEPS)
C     2.)  2.0*BASE**(T-1),  WHERE T IS NO. OF DIGITS IN MANTISSA
C     3.)  2.0*(MAXINT+1)
C     FOR IBM 360/370 (S.P.)
CR8   DATA XVBIG /2.1D+6/
C     FOR IEEE SINGLE PRECISION
CR0   DATA XVBIG /8.388608E+6/
C     FOR DEC-10, UNIVAC 1100(S.P.)
CR2   DATA XVBIG /8.7D+7/
C     FOR ICL 1900
CR3   DATA XVBIG /1.6777216D+7/
C     FOR CDC 7600/CYBER
CR4   DATA XVBIG /1.8D+14/
C     FOR IBM 360/370 AND SIMILAR MACHINES (D.P.)
CR9   DATA XVBIG /4.294967296D+9/
C     FOR UNIVAC 1100(D.P.)
CR5   DATA XVBIG /6.8719476736D+10/
C     FOR IEEE DOUBLE PRECISION
CR7   DATA XVBIG /4.294967296D+9/
C
C     .. Executable Statements ..
C     NO FAILURE EXITS
      IFAIL = 0
      U = ABS(X)
C      SWITCH ON BASIC RANGE
      IF (U.GT.3.0D0) GO TO 40
C     LOWER RANGE
      IF (U.GE.XSMALL) GO TO 20
C     X IN LIMITING RANGE
      S20ADF = X
      GO TO 280
C
C     X IN BASIC LOWER RANGE
   20 T = X/3.0D0
      T = T*T
      T = 2.0D0*T*T - 1.0D0
C
C      * EXPANSION (0051) *
C
C     EXPANSION (0051) EVALUATED AS Y(T)  --PRECISION 08E.09
C08   Y = (((((((((((((((-1.30342972D-5)*T+1.09422578D-4)
C08  *    *T-7.41035352D-4)*T+4.45420608D-3)*T-2.22215620D-2)
C08  *    *T+8.92428847D-2)*T-2.78502318D-1)*T+6.36119616D-1)
C08  *    *T-9.40751488D-1)*T+5.74957819D-1)*T+6.50111442D-1)
C08  *    *T-1.37383189D+0)*T+4.46656174D-1)*T+4.96540249D-1)
C08  *    *T-2.53584714D-1)*T + 1.73361153D-1
C
C     EXPANSION (0051) EVALUATED AS Y(T)  --PRECISION 09E.10
C09   Y = ((((((((((((((((+1.350472467D-6)*T-1.303429717D-5)
C09  *    *T+1.040206881D-4)*T-7.410353525D-4)*T+4.462984150D-3)
C09  *    *T-2.222156202D-2)*T+8.923545706D-2)*T-2.785023176D-1)
C09  *    *T+6.361230977D-1)*T-9.407514877D-1)*T+5.749569328D-1)
C09  *    *T+6.501114419D-1)*T-1.373831775D+0)*T+4.466561742D-1)
C09  *    *T+4.965402437D-1)*T-2.535847143D-1)*T + 1.733611529D-1
C
C     EXPANSION (0051) EVALUATED AS Y(T)  --PRECISION 12E.13
C12   Y = (((((((((((((((+9.905640605036D-9*T-1.228945840911D-7)
C12  *    *T+1.305897084713D-6)*T-1.251199518446D-5)
C12  *    *T+1.041042669400D-4)*T-7.419493809427D-4)
C12  *    *T+4.462899642816D-3)*T-2.222071327842D-2)
C12  *    *T+8.923550686146D-2)*T-2.785027664733D-1)
C12  *    *T+6.361230804231D-1)*T-9.407513530168D-1)
C12  *    *T+5.749569361804D-1)*T+6.501114204947D-1)
C12  *    *T-1.373831774913D+0)*T+4.466561757329D-1)
C12  *    *T+4.965402437019D-1
C12   Y = (Y*T-2.535847143055D-1)*T + 1.733611529162D-1
C
C     EXPANSION (0051) EVALUATED AS Y(T)  --PRECISION 15E.16
C15   Y = (((((((((((((((+4.601208017397010D-11
C15  *    *T-7.124020839997503D-10)*T+9.675580204165974D-9)
C15  *    *T-1.195106741920940D-7)*T+1.306385963064723D-6)
C15  *    *T-1.251876300425634D-5)*T+1.041036917890246D-4)
C15  *    *T-7.419419786397529D-4)*T+4.462900051712761D-3)
C15  *    *T-2.222071808992009D-2)*T+8.923550668154524D-2)
C15  *    *T-2.785027645830666D-1)*T+6.361230804712476D-1)
C15  *    *T-9.407513534529985D-1)*T+5.749569361730083D-1)
C15  *    *T+6.501114205492620D-1)*T-1.373831774911955D+0
C15   Y = (((Y*T+4.466561757298178D-1)*T+4.965402437018819D-1)
C15  *    *T-2.535847143054266D-1)*T + 1.733611529161628D-1
C
C     EXPANSION (0051) EVALUATED AS Y(T)  --PRECISION 17E.18
      Y = (((((((((((((((-2.68423468693533491D-12
     *    *T+4.60120801739700961D-11)*T-6.98309851893339783D-10)
     *    *T+9.67558020416597367D-9)*T-1.19542381714333397D-7)
     *    *T+1.30638596306472254D-6)*T-1.25187230762653703D-5)
     *    *T+1.04103691789024646D-4)*T-7.41942009466510585D-4)
     *    *T+4.46290005171276125D-3)*T-2.22207180748920449D-2)
     *    *T+8.92355066815452417D-2)*T-2.78502764587658541D-1)
     *    *T+6.36123080471247636D-1)*T-9.40751353452155090D-1)
     *    *T+5.74956936173008309D-1)*T+6.50111420549176823D-1
      Y = ((((Y*T-1.37383177491195539D+0)*T+4.46656175729821733D-1)
     *    *T+4.96540243701881862D-1)*T-2.53584714305426699D-1)*T +
     *    1.73361152916162812D-1
C
C     EXPANSION (0051) EVALUATED AS Y(T)  --PRECISION 19E.20
C19   Y = (((((((((((((((+1.4216946727780352000D-13
C19  *    *T-2.6842346869353349120D-12)*T+4.5230148103942176768D-11)
C19  *    *T-6.9830985189333978317D-10)*T+9.6774372928322899804D-9)
C19  *    *T-1.1954238171433339650D-7)*T+1.3063834706562493211D-6)
C19  *    *T-1.2518723076265370261D-5)*T+1.0410369386603170663D-4)
C19  *    *T-7.4194200946651058518D-4)*T+4.4629000506009515924D-3)
C19  *    *T-2.2220718074892044934D-2)*T+8.9235506681927426242D-2)
C19  *    *T-2.7850276458765854088D-1)*T+6.3612308047116573979D-1)
C19  *    *T-9.4075135345215508981D-1)*T+5.7495693617301854600D-1
C19   Y = (((((Y*T+6.5011142054917682329D-1)
C19  *    *T-1.3738317749119560467D+0)
C19  *    *T+4.4665617572982173298D-1)*T+4.9654024370188187800D-1)
C19  *    *T-2.5358471430542669886D-1)*T + 1.7336115291616281167D-1
C
      S20ADF = X*Y
      GO TO 280
C
C     UPPER RANGE
   40 IF (U.LT.XVBIG) GO TO 60
C     X IN LIMITING LARGE X RANGE
      S20ADF = SIGN(0.5D0,X)
      GO TO 280
C
C     X IN BASIC UPPER RANGE OR SEMI LIMITING RANGE
C     CALC. EFECTIVE ARGUMENT OF SIN AND COS
   60 T = 0.5D0*U
      K = T
      Y = DBLE(K)
      A = T - Y
      T = A*Y
      K = T
      B = T - DBLE(K)
      T = (2.0D0*B+A*A)*4.0D0
      K = T
      TH = ((8.0D0*B-DBLE(K))+4.0D0*A*A)/TBPI
      N = MOD(K,4) + 1
C     CALC. SIN
      GO TO (80,100,120,140) N
   80 S = SIN(TH)
      GO TO 160
  100 S = COS(TH)
      GO TO 160
  120 S = -SIN(TH)
      GO TO 160
  140 S = -COS(TH)
C     EVAL. F AND SEMI LIMITING FORM
  160 T = 3.0D0/X
      T = T*T
      T = 2.0D0*T*T - 1.0D0
C
C      * EXPANSION (0053) *
C
C     EXPANSION (0053) EVALUATED AS F(T)  --PRECISION 08E.09
C08   F = (((((-5.93583900D-9)*T+4.72717282D-8)*T-5.42175825D-7)
C08  *    *T+1.10965120D-5)*T-5.73211031D-4)*T + 3.17724983D-1
C
C     EXPANSION (0053) EVALUATED AS F(T)  --PRECISION 09E.10
C09   F = ((((((+9.829047856D-10)*T-5.935838999D-9)*T+4.579737107D-8)
C09  *    *T-5.421758250D-7)*T+1.109706487D-5)*T-5.732110305D-4)*T +
C09  *    3.177249832D-1
C
C     EXPANSION (0053) EVALUATED AS F(T)  --PRECISION 12E.13
C12   F = (((((((((-1.357202069887D-11)*T+4.878102142618D-11)
C12  *    *T-1.707125662642D-10)*T+8.853427427869D-10)
C12  *    *T-5.606554961046D-9)*T+4.585834734726D-8)
C12  *    *T-5.423455565629D-7)*T+1.109705267873D-5)
C12  *    *T-5.732110089693D-4)*T + 3.177249831933D-1
C
C     EXPANSION (0053) EVALUATED AS F(T)  --PRECISION 15E.16
C15   F = (((((((((((((-2.202608491851653D-13)*T+5.462909561870602D-13)
C15  *    *T-7.426524837273958D-13)*T+2.597867258691246D-12)
C15  *    *T-1.045595472884368D-11)*T+4.003290308517780D-11)
C15  *    *T-1.741865561141896D-10)*T+8.936546026418932D-10)
C15  *    *T-5.604956794638033D-9)*T+4.585526145869023D-8)
C15  *    *T-5.423458503385860D-7)*T+1.109705307327023D-5)
C15  *    *T-5.732110089543312D-4)*T + 3.177249831932574D-1
C
C     EXPANSION (0053) EVALUATED AS F(T)  --PRECISION 17E.18
      F = ((((((((((((((((+2.07506727741685760D-14)
     *    *T-4.32090910458347520D-14)*T+1.17703805954293760D-14)
     *    *T-5.82267577632849920D-14)*T+3.49464578296793088D-13)
     *    *T-9.85703620860216320D-13)*T+2.93983396595156736D-12)
     *    *T-1.02702906657561134D-11)*T+3.97754267719339848D-11)
     *    *T-1.74262509594543650D-10)*T+8.93749825962406591D-10)
     *    *T-5.60494084440715823D-9)*T+4.58552450207356043D-8)
     *    *T-5.42345851815459185D-7)*T+1.10970530743229298D-5)
     *    *T-5.73211008954291666D-4)*T + 3.17724983193257364D-1
C
C     EXPANSION (0053) EVALUATED AS F(T)  --PRECISION 19E.20
C19   F = (((((((((((((((+1.6966016198246400000D-15
C19  *    *T-2.9966939295580160000D-15)*T-2.9966396020490240000D-15)
C19  *    *T+3.7898570028154880000D-15)*T+1.4088406747971584000D-14)
C19  *    *T-2.7288816935649280000D-14)*T+3.6854094541684736000D-14)
C19  *    *T-1.0476975117319782400D-13)*T+3.1773621848230502400D-13)
C19  *    *T-9.3381110275379200000D-13)*T+2.9607818488980126720D-12)
C19  *    *T-1.0300486158980194560D-11)*T+3.9767656163120972800D-11)
C19  *    *T-1.7425290047965440480D-10)*T+8.9375140905558722070D-10)
C19  *    *T-5.6049424356830408410D-9)*T+4.5855244861268141885D-8
C19   F = (((F*T-5.4234585169844556520D-7)*T+1.1097053074329063571D-5)
C19  *    *T-5.7321100895429415857D-4)*T + 3.1772498319325736402D-1
C
      S20ADF = F*S/X + SIGN(0.5D0,X)
      IF (U.GT.XBIG) GO TO 280
C
C     BASIC UPPER RANGE
C     EVAL. C AND G , COMPLETE UPPER RANGE FORM
      GO TO (180,200,220,240) N
  180 C = COS(TH)
      GO TO 260
  200 C = -SIN(TH)
      GO TO 260
  220 C = -COS(TH)
      GO TO 260
  240 C = SIN(TH)
  260 CONTINUE
C
C      * EXPANSION (0054) *
C
C     EXPANSION (0054) EVALUATED AS G(T)  --PRECISION 08E.09
C08   G = ((((((+6.24327451D-9)*T-3.29585381D-8)*T+2.12006168D-7)
C08  *    *T-2.00950571D-6)*T+2.97191981D-5)*T-8.84035394D-4)*T +
C08  *    1.00405168D-1
C
C     EXPANSION (0054) EVALUATED AS G(T)  --PRECISION 09E.10
C09   G = (((((((-1.427253493D-9)*T+6.243274506D-9)*T-3.046084452D-8)
C09  *    *T+2.120061684D-7)*T-2.010754562D-6)*T+2.971919810D-5)
C09  *    *T-8.840352376D-4)*T + 1.004051683D-1
C
C     EXPANSION (0054) EVALUATED AS G(T)  --PRECISION 12E.13
C12   G = (((((((((((-1.402758722109D-11)*T+3.829716986454D-11)
C12  *    *T-7.582193245551D-11)*T+2.838631657901D-10)
C12  *    *T-1.208434313657D-9)*T+5.567837384643D-9)
C12  *    *T-3.063701386332D-8)*T+2.124507563370D-7)
C12  *    *T-2.010703951449D-6)*T+2.971910693717D-5)
C12  *    *T-8.840352414821D-4)*T + 1.004051683139D-1
C
C     EXPANSION (0054) EVALUATED AS G(T)  --PRECISION 15E.16
C15   G = ((((((((((((((((+2.521469981689119D-13)
C15  *    *T-5.048511878397133D-13)*T+5.277765106919014D-14)
C15  *    *T-4.624209772280136D-13)*T+3.479134312657932D-12)
C15  *    *T-9.211633124902072D-12)*T+2.535330780212986D-11)
C15  *    *T-8.322232754249400D-11)*T+2.997786114508160D-10)
C15  *    *T-1.203579940865046D-9)*T+5.559169647770702D-9)
C15  *    *T-3.063850219580606D-8)*T+2.124528522698467D-7)
C15  *    *T-2.010703759368367D-6)*T+2.971910675359472D-5)
C15  *    *T-8.840352414891330D-4)*T + 1.004051683139144D-1
C
C     EXPANSION (0054) EVALUATED AS G(T)  --PRECISION 17E.18
      G = (((((((((((((((-4.03463395677306880D-14
     *    *T+7.15411005552721920D-14)*T+6.00164238700707840D-14)
     *    *T-6.97879543298129920D-14)*T-3.28719485157392384D-13)
     *    *T+6.56405687004299264D-13)*T-1.02218566766464614D-12)
     *    *T+2.86879929854576640D-12)*T-8.57506788593757696D-12)
     *    *T+2.57129695068745262D-11)*T-8.35960290000537167D-11)
     *    *T+2.99654113168404345D-10)*T-1.20346041915192622D-9)
     *    *T+5.55919385577005967D-9)*T-3.06385220528144918D-8)
     *    *T+2.12452849911924725D-7)*T-2.01070375790489234D-6
      G = ((G*T+2.97191067536831375D-5)
     *    *T-8.84035241489164211D-4)*T + 1.00405168313914407D-1
C
C     EXPANSION (0054) EVALUATED AS G(T)  --PRECISION 19E.20
C19   G = (((((((((((((((-5.5973482940334080000D-15
C19  *    *T+8.7869648200007680000D-15)*T+1.8010667322703872000D-14)
C19  *    *T-2.4787441302896640000D-14)*T-4.6394273112522752000D-14)
C19  *    *T+6.8616502480994304000D-14)*T+7.2432219213004800000D-15)
C19  *    *T+2.6287261495066624000D-14)*T-2.2046886451014860800D-13)
C19  *    *T+4.9051693608265318400D-13)*T-1.1251226547783802880D-12)
C19  *    *T+3.0092835359540797440D-12)*T-8.5185937341252208640D-12)
C19  *    *T+2.5644542449373548032D-11)*T-8.3614658325737224704D-11)
C19  *    *T+2.9967370727686276813D-10)*T-1.2034568082551629090D-9
C19   G = ((((((G*T+5.5591906952804112065D-9)
C19  *    *T-3.0638522432231969874D-8)
C19  *    *T+2.1245285016771020051D-7)*T-2.0107037578867765040D-6)
C19  *    *T+2.9719106753675171307D-5)*T-8.8403524148916446459D-4)*T +
C19  *    1.0040516831391440676D-1
C
      S20ADF = S20ADF - C*G/(X*X*X)
  280 RETURN
      END
