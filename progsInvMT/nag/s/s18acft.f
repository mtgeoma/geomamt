      DOUBLE PRECISION FUNCTION S18ACF(X,IFAIL)
C     MARK 7 RELEASE. NAG COPYRIGHT 1978.
C     MARK 11.5(F77) REVISED. (SEPT 1985.)
C     BESSEL FUNCTION K0(X)
C
C     **************************************************************
C
C     TO EXTRACT THE CORRECT CODE FOR A PARTICULAR MACHINE-RANGE,
C     ACTIVATE THE STATEMENTS CONTAINED IN COMMENTS BEGINNING  CDD ,
C     WHERE  DD  IS THE APPROXIMATE NUMBER OF SIGNIFICANT DECIMAL
C     DIGITS REPRESENTED BY THE MACHINE
C     DELETE THE ILLEGAL DUMMY STATEMENTS OF THE FORM
C     * EXPANSION (NNNN) *
C
C     ALSO INSERT APPROPRIATE DATA STATEMENTS TO DEFINE CONSTANTS
C     WHICH DEPEND ON THE RANGE OF NUMBERS REPRESENTED BY THE
C     MACHINE, RATHER THAN THE PRECISION (SUITABLE STATEMENTS FOR
C     SOME MACHINES ARE CONTAINED IN COMMENTS BEGINNING CRD WHERE
C     D IS A DIGIT WHICH SIMPLY DISTINGUISHES A GROUP OF MACHINES).
C     DELETE THE ILLEGAL DUMMY DATA STATEMENTS WITH VALUES WRITTEN
C     *VALUE*
C
C     **************************************************************
C
C     .. Parameters ..
      CHARACTER*6                      SRNAME
      PARAMETER                        (SRNAME='S18ACF')
C     .. Scalar Arguments ..
      DOUBLE PRECISION                 X
      INTEGER                          IFAIL
C     .. Local Scalars ..
      DOUBLE PRECISION                 EGAM, G, T, XBIG, XVSMAL, Y
C     .. Local Arrays ..
      CHARACTER*1                      P01REC(1)
C     .. External Functions ..
      INTEGER                          P01ABF
      EXTERNAL                         P01ABF
C     .. Intrinsic Functions ..
      INTRINSIC                        LOG, EXP, SQRT
C     .. Data statements ..
C08   DATA XVSMAL,EGAM/1.0D-4,5.77215665D-1/
C09   DATA XVSMAL,EGAM/3.2D-5,5.772156649D-1/
C12   DATA XVSMAL,EGAM/1.0D-6,5.772156649015D-1/
C15   DATA XVSMAL,EGAM/3.2D-8,5.772156649015329D-1/
      DATA XVSMAL,EGAM/3.2D-9,5.77215664901532861D-1/
C19   DATA XVSMAL,EGAM/3.2D-10,5.7721566490153286061D-1/
      DATA XBIG / 7.051D+2 /
C     XBIG = LARGEST X SUCH THAT  EXP(-X)/SQRT(X) .GT. MINREAL
C             (ROUNDED DOWN)
C     FOR IEEE SINGLE PRECISION
CR0   DATA XBIG /85.1E0/
C     FOR IBM 360/370 AND SIMILAR MACHINES
CR1   DATA XBIG /177.6D0/
C     FOR DEC-10, HONEYWELL, UNIVAC 1100(S.P.)
CR2   DATA XBIG /87.1D0/
C     FOR ICL 1900
CR3   DATA XBIG /175.5D0/
C     FOR CDC 7600/CYBER
CR4   DATA XBIG /672.5D0/
C     FOR UNIVAC 1100(D.P.)
CR5   DATA XBIG /707.1D0/
C     FOR IEEE DOUBLE PRECISION
CR7   DATA XBIG /705.1D0/
C     .. Executable Statements ..
C
C     ERROR 1 TEST
      IF (X.LE.0.0D0) GO TO 120
      IFAIL = 0
C     TEST FOR VERY LARGE X
      IF (X.LT.XBIG) GO TO 20
      S18ACF = 0.0D0
      GO TO 140
C     X RANGE TEST
   20 IF (X.GT.4.0D0) GO TO 100
C     TESTS FOR MIDDLE RANGES
      IF (X.GT.2.0D0) GO TO 80
      IF (X.GT.1.0D0) GO TO 60
C     SMALL X
C     TEST FOR VERY SMALL X
      IF (X.GT.XVSMAL) GO TO 40
      S18ACF = -(LOG(0.5D0*X)+EGAM)
      GO TO 140
   40 T = 2.0D0*X*X - 1.0D0
C
C      * EXPANSION (0038) *
C
C     EXPANSION (0038) EVALUATED AS G(T)  --PRECISION 08E.09
C08   G = ((((+4.34573908D-7)*T+5.59729386D-5)*T+4.07157485D-3)
C08  *    *T+1.32976966D-1)*T + 1.12896093D+0
C
C     EXPANSION (0038) EVALUATED AS G(T)  --PRECISION 09E.10
C09   G = (((((+2.163857486D-9)*T+4.345739082D-7)*T+5.597023381D-5)
C09  *    *T+4.071574848D-3)*T+1.329769665D-1)*T + 1.128960929D+0
C
C     EXPANSION (0038) EVALUATED AS G(T)  --PRECISION 12E.13
C12   G = ((((((+7.491107368941D-12)*T+2.163857486232D-9)
C12  *    *T+4.345626715462D-7)*T+5.597023380611D-5)
C12  *    *T+4.071574851714D-3)*T+1.329769664783D-1)*T +
C12  *    1.128960929454D+0
C
C     EXPANSION (0038) EVALUATED AS G(T)  --PRECISION 15E.16
C15   G = (((((((+1.906741975145613D-14)*T+7.491107368941348D-12)
C15  *    *T+2.163824118247215D-9)*T+4.345626715461582D-7)
C15  *    *T+5.597023382279154D-5)*T+4.071574851713890D-3)
C15  *    *T+1.329769664783382D-1)*T + 1.128960929454128D+0
C
C     EXPANSION (0038) EVALUATED AS G(T)  --PRECISION 17E.18
      G = (((((((+1.90674197514561280D-14)*T+7.49110736894134794D-12)
     *    *T+2.16382411824721532D-9)*T+4.34562671546158210D-7)
     *    *T+5.59702338227915383D-5)*T+4.07157485171389048D-3)
     *    *T+1.32976966478338191D-1)*T + 1.12896092945412762D+0
C
C     EXPANSION (0038) EVALUATED AS G(T)  --PRECISION 19E.20
C19   G = ((((((((+3.7176528408320000000D-17)
C19  *    *T+1.9067419751456128000D-14)*T+7.4910330158845312960D-12)
C19  *    *T+2.1638241182472153204D-9)*T+4.3456267159262887034D-7)
C19  *    *T+5.5970233822791538283D-5)*T+4.0715748517138811890D-3)
C19  *    *T+1.3297696647833819059D-1)*T + 1.1289609294541276238D+0
C
C      * EXPANSION (0039) *
C
C     EXPANSION (0039) EVALUATED AS Y(T)  --PRECISION 08E.09
C08   Y = (((((+5.19915911D-9)*T+9.57907354D-7)*T+1.09534293D-4)
C08  *    *T+6.63513978D-3)*T+1.52436922D-1)*T + 2.61841879D-1
C
C     EXPANSION (0039) EVALUATED AS Y(T)  --PRECISION 09E.10
C09   Y = (((((+5.199159110D-9)*T+9.579073542D-7)*T+1.095342926D-4)
C09  *    *T+6.635139782D-3)*T+1.524369218D-1)*T + 2.618418793D-1
C
C     EXPANSION (0039) EVALUATED AS Y(T)  --PRECISION 12E.13
C12   Y = ((((((+1.924073723741D-11)*T+5.199159109887D-9)
C12  *    *T+9.578784931342D-7)*T+1.095342925872D-4)
C12  *    *T+6.635139793139D-3)*T+1.524369217994D-1)*T +
C12  *    2.618418792587D-1
C
C     EXPANSION (0039) EVALUATED AS Y(T)  --PRECISION 15E.16
C15   Y = (((((((+5.168678869463322D-14)*T+1.924073723740705D-11)
C15  *    *T+5.199068658006656D-9)*T+9.578784931341698D-7)
C15  *    *T+1.095342926324015D-4)*T+6.635139793139465D-3)
C15  *    *T+1.524369217993952D-1)*T + 2.618418792586871D-1
C
C     EXPANSION (0039) EVALUATED AS Y(T)  --PRECISION 17E.18
      Y = ((((((((+1.05407718191360000D-16)*T+5.16867886946332160D-14)
     *    *T+1.92405264219706684D-11)*T+5.19906865800665633D-9)
     *    *T+9.57878493265929443D-7)*T+1.09534292632401542D-4)
     *    *T+6.63513979313943827D-3)*T+1.52436921799395196D-1)*T +
     *    2.61841879258687055D-1
C
C     EXPANSION (0039) EVALUATED AS Y(T)  --PRECISION 19E.20
C19   Y = ((((((((+1.0540771819136000000D-16)
C19  *    *T+5.1686788694633216000D-14)*T+1.9240526421970668416D-11)
C19  *    *T+5.1990686580066563318D-9)*T+9.5787849326592944289D-7)
C19  *    *T+1.0953429263240154213D-4)*T+6.6351397931394382728D-3)
C19  *    *T+1.5243692179939519592D-1)*T + 2.6184187925868705504D-1
C
      S18ACF = -LOG(X)*G + Y
      GO TO 140
C
C     LOWER MIDDLE X
   60 T = 2.0D0*X - 3.0D0
C
C      * EXPANSION (0040) *
C
C     EXPANSION (0040) EVALUATED AS Y(T)  --PRECISION 08E.09
C08   Y = ((((((((((+1.97827187D-6)*T-6.31672706D-6)*T+1.54109089D-5)
C08  *    *T-5.21368223D-5)*T+1.82977474D-4)*T-6.33386768D-4)
C08  *    *T+2.24701968D-3)*T-8.27767479D-3)*T+3.23582078D-2)
C08  *    *T-1.42477917D-1)*T + 9.58210053D-1
C
C     EXPANSION (0040) EVALUATED AS Y(T)  --PRECISION 09E.10
C09   Y = ((((((((((((+1.983092535D-7)*T-6.243223381D-7)
C09  *    *T+1.383344113D-6)*T-4.599840627D-6)*T+1.608020266D-5)
C09  *    *T-5.385370878D-5)*T+1.826304327D-4)*T-6.326356301D-4)
C09  *    *T+2.247101020D-3)*T-8.277808917D-3)*T+3.235820083D-2)
C09  *    *T-1.424779099D-1)*T + 9.582100533D-1
C
C     EXPANSION (0040) EVALUATED AS Y(T)  --PRECISION 12E.13
C12   Y = (((((((((((((((-6.551671183186D-9)*T+2.032857502141D-8)
C12  *    *T-3.877199898304D-8)*T+1.271592408894D-7)
C12  *    *T-4.553179992977D-7)*T+1.481175380388D-6)
C12  *    *T-4.829010776737D-6)*T+1.601349952432D-5)
C12  *    *T-5.371083227060D-5)*T+1.826537788219D-4)
C12  *    *T-6.326782429043D-4)*T+2.247097129415D-3)
C12  *    *T-8.277803511775D-3)*T+3.235820107298D-2)
C12  *    *T-1.424779101287D-1)*T + 9.582100532948D-1
C
C     EXPANSION (0040) EVALUATED AS Y(T)  --PRECISION 15E.16
C15   Y = (((((((((((((((-7.307038289808510D-11
C15  *    *T+2.238914711011108D-10)*T-3.407475424178312D-10)
C15  *    *T+1.111842741510382D-9)*T-4.322554410687399D-9)
C15  *    *T+1.374024186296710D-8)*T-4.312850150329360D-8)
C15  *    *T+1.390249701260793D-7)*T-4.510611710221338D-7)
C15  *    *T+1.470644510787501D-6)*T-4.831329096004881D-6)
C15  *    *T+1.601857386115144D-5)*T-5.371012335242130D-5)
C15  *    *T+1.826524637557902D-4)*T-6.326783572119693D-4)
C15  *    *T+2.247097295888664D-3)*T-8.277803503528437D-3
C15   Y = ((Y*T+3.235820106497412D-2)*T-1.424779101288281D-1)*T +
C15  *    9.582100532948965D-1
C
C     EXPANSION (0040) EVALUATED AS Y(T)  --PRECISION 17E.18
      Y = (((((((((((((((+2.57466288575820595D-12
     *    *T-7.83738609108569293D-12)*T+9.74410152270679245D-12)
     *    *T-3.19241059198852137D-11)*T+1.37999268074442719D-10)
     *    *T-4.33326665618780914D-10)*T+1.32069362385968867D-9)
     *    *T-4.20597329258249948D-9)*T+1.34790467361340101D-8)
     *    *T-4.32185089841834127D-8)*T+1.39217270224614153D-7)
     *    *T-4.51017292375200017D-7)*T+1.47055796078231691D-6)
     *    *T-4.83134250336922161D-6)*T+1.60185974149720562D-5)
     *    *T-5.37101208898441760D-5)*T+1.82652460089342789D-4
      Y = (((((Y*T-6.32678357460594866D-4)*T+2.24709729617770471D-3)
     *    *T-8.27780350351692662D-3)*T+3.23582010649653009D-2)
     *    *T-1.42477910128828254D-1)*T + 9.58210053294896496D-1
C
C     EXPANSION (0040) EVALUATED AS Y(T)  --PRECISION 19E.20
C19   Y = (((((((((((((((+2.7933516521642393600D-13
C19  *    *T-8.4734368466704793600D-13)*T+8.9865189445966233600D-13)
C19  *    *T-2.9651599042501672960D-12)*T+1.4143630374865469440D-11)
C19  *    *T-4.4104671386974027776D-11)*T+1.3136505790055265075D-10)
C19  *    *T-4.1596935982817935360D-10)*T+1.3270375873384710472D-9)
C19  *    *T-4.2215035135530377216D-9)*T+1.3475040022357937062D-8)
C19  *    *T-4.3209449688617265390D-8)*T+1.3921895823828833229D-7)
C19  *    *T-4.5102075622350472071D-7)*T+1.4705574926776845760D-6)
C19  *    *T-4.8313416528707539398D-6)*T+1.6018597497256073653D-5
C19   Y = (((((((Y*T-5.3710121017418946180D-5)
C19  *    *T+1.8265246008080963128D-4)
C19  *    *T-6.3267835744996363552D-4)*T+2.2470972961781618414D-3)
C19  *    *T-8.2778035035173355113D-3)*T+3.2358201064965291340D-2)
C19  *    *T-1.4247791012882824906D-1)*T + 9.5821005329489649642D-1
C
      S18ACF = EXP(-X)*Y
      GO TO 140
C
C     UPPER MIDDLE X
   80 T = X - 3.0D0
C
C      * EXPANSION (0041) *
C
C     EXPANSION (0041) EVALUATED AS Y(T)  --PRECISION 08E.09
C08   Y = ((((((((((+1.78345710D-6)*T-5.64988459D-6)*T+1.35832144D-5)
C08  *    *T-4.54669161D-5)*T+1.57748141D-4)*T-5.37788255D-4)
C08  *    *T+1.87285855D-3)*T-6.74447929D-3)*T+2.56253708D-2)
C08  *    *T-1.08801888D-1)*T + 6.97761598D-1
C
C     EXPANSION (0041) EVALUATED AS Y(T)  --PRECISION 09E.10
C09   Y = ((((((((((((+1.811062124D-7)*T-5.667269591D-7)
C09  *    *T+1.240138468D-6)*T-4.091385457D-6)*T+1.419444784D-5)
C09  *    *T-4.702541521D-5)*T+1.574312047D-4)*T-5.371064113D-4)
C09  *    *T+1.872932832D-3)*T-6.744601048D-3)*T+2.562536439D-2)
C09  *    *T-1.088018819D-1)*T + 6.977615980D-1
C
C     EXPANSION (0041) EVALUATED AS Y(T)  --PRECISION 12E.13
C12   Y = ((((((((((((((((+1.971120605906D-9)*T-6.070025346086D-9)
C12  *    *T+1.086937087511D-8)*T-3.539375002864D-8)
C12  *    *T+1.282800098365D-7)*T-4.118627301883D-7)
C12  *    *T+1.319550223197D-6)*T-4.301563469146D-6)
C12  *    *T+1.413799355685D-5)*T-4.689432908734D-5)
C12  *    *T+1.574514487553D-4)*T-5.371455160852D-4)
C12  *    *T+1.872929403896D-3)*T-6.744596087107D-3)
C12  *    *T+2.562536460295D-2)*T-1.088018820848D-1)*T +
C12  *    6.977615980439D-1
C
C     EXPANSION (0041) EVALUATED AS Y(T)  --PRECISION 15E.16
C15   Y = (((((((((((((((-6.861157762269000D-11
C15  *    *T+2.096218927461184D-10)*T-3.160507602633855D-10)
C15  *    *T+1.027822088548940D-9)*T-3.993523379123762D-9)
C15  *    *T+1.263805559515564D-8)*T-3.945537877506573D-8)
C15  *    *T+1.264916730640405D-7)*T-4.078926194253785D-7)
C15  *    *T+1.320604064509593D-6)*T-4.303726063739488D-6)
C15  *    *T+1.413762876562252D-5)*T-4.689366770560801D-5)
C15  *    *T+1.574515196869042D-4)*T-5.371456227372635D-4)
C15  *    *T+1.872929396987552D-3)*T-6.744596079412555D-3
C15   Y = ((Y*T+2.562536460320434D-2)*T-1.088018820849350D-1)*T +
C15  *    6.977615980438517D-1
C
C     EXPANSION (0041) EVALUATED AS Y(T)  --PRECISION 17E.18
      Y = (((((((((((((((+2.43538242247537459D-12
     *    *T-7.39672783987933184D-12)*T+9.11109430833001267D-12)
     *    *T-2.97787564633235128D-11)*T+1.28905587479980147D-10)
     *    *T-4.03424607871960089D-10)*T+1.22424982779432970D-9)
     *    *T-3.88349705250555658D-9)*T+1.23923137898346852D-8)
     *    *T-3.95403255713518420D-8)*T+1.26672629417567360D-7)
     *    *T-4.07851207862189007D-7)*T+1.32052261058932425D-6)
     *    *T-4.30373871727268511D-6)*T+1.41376509343622727D-5)
     *    *T-4.68936653814896712D-5)*T+1.57451516235860573D-4
      Y = (((((Y*T-5.37145622971910027D-4)*T+1.87292939725962385D-3)
     *    *T-6.74459607940169198D-3)*T+2.56253646031960321D-2)
     *    *T-1.08801882084935132D-1)*T + 6.97761598043851776D-1
C
C     EXPANSION (0041) EVALUATED AS Y(T)  --PRECISION 19E.20
C19   Y = (((((((((((((((+2.6528880914543411200D-13
C19  *    *T-8.0317858030026752000D-13)*T+8.4364956760276992000D-13)
C19  *    *T-2.7784510031527936000D-12)*T+1.3289393052370599936D-11)
C19  *    *T-4.1324448555139858432D-11)*T+1.2260497826277608653D-10)
C19  *    *T-3.8697199664112179610D-10)*T+1.2302747853582810808D-9)
C19  *    *T-3.8982178099226224230D-9)*T+1.2388508553478505349D-8)
C19  *    *T-3.9531738462858553639D-8)*T+1.2667423254955075023D-7)
C19  *    *T-4.0785449116837761689D-7)*T+1.3205221660233120470D-6)
C19  *    *T-4.3037379111037548739D-6)*T+1.4137651012508642025D-5
C19   Y = (((((((Y*T-4.6893665502415010748D-5)
C19  *    *T+1.5745151622775650551D-4)
C19  *    *T-5.3714562296183291504D-4)*T+1.8729293972600579925D-3)
C19  *    *T-6.7445960794020795628D-3)*T+2.5625364603196023000D-2)
C19  *    *T-1.0880188208493512714D-1)*T + 6.9776159804385177606D-1
C
      S18ACF = EXP(-X)*Y
      GO TO 140
C
C     LARGE X
  100 T = 10.0D0/(1.0D0+X) - 1.0D0
C
C      * EXPANSION (0042) *
C
C     EXPANSION (0042) EVALUATED AS Y(T)  --PRECISION 08E.09
C08   Y = ((((((-4.11446380D-8)*T-7.86187344D-7)*T-6.31723532D-6)
C08  *    *T-9.02467382D-5)*T-9.25551400D-4)*T-1.72683663D-2)*T +
C08  *    1.23688665D+0
C
C     EXPANSION (0042) EVALUATED AS Y(T)  --PRECISION 09E.10
C09   Y = (((((((-9.959161962D-9)*T-4.114463804D-8)*T-7.687588103D-7)
C09  *    *T-6.317235316D-6)*T-9.025545245D-5)*T-9.255514000D-4)
C09  *    *T-1.726836523D-2)*T + 1.236886648D+0
C
C     EXPANSION (0042) EVALUATED AS Y(T)  --PRECISION 12E.13
C12   Y = (((((((((-2.579383902716D-10)*T+2.760154639287D-10)
C12  *    *T-9.378800583594D-9)*T-4.169666896589D-8)
C12  *    *T-7.691940813126D-7)*T-6.316890296318D-6)
C12  *    *T-9.025533153759D-5)*T-9.255514690352D-4)
C12  *    *T-1.726836523868D-2)*T + 1.236886647694D+0
C
C     EXPANSION (0042) EVALUATED AS Y(T)  --PRECISION 15E.16
C15   Y = (((((((((((((-1.211750648265150D-12)*T+3.909769960560914D-12)
C15  *    *T-1.041856660886294D-11)*T+3.335332630785330D-11)
C15  *    *T-2.233800476869180D-10)*T+1.765043470717131D-10)
C15  *    *T-9.415328020981635D-9)*T-4.160489279665359D-8)
C15  *    *T-7.691776698192549D-7)*T-6.316923913510901D-6)
C15  *    *T-9.025533451436175D-5)*T-9.255514647700555D-4)
C15  *    *T-1.726836523853228D-2)*T + 1.236886647694254D+0
C
C     EXPANSION (0042) EVALUATED AS Y(T)  --PRECISION 17E.18
      Y = ((((((((((((((((+4.43741979886551040D-14)
     *    *T-1.28108310826991616D-13)*T+2.06328892562554880D-13)
     *    *T-7.31344482663931904D-13)*T+2.85481235167705907D-12)
     *    *T-1.11391758572647639D-11)*T+3.49564293256545992D-11)
     *    *T-2.22829582288833265D-10)*T+1.75359321273580603D-10)
     *    *T-9.41555321137176073D-9)*T-4.16044811174114579D-8)
     *    *T-7.69177622529272933D-7)*T-6.31692398333746470D-6)
     *    *T-9.02553345187404564D-5)*T-9.25551464765637133D-4)
     *    *T-1.72683652385321641D-2)*T + 1.23688664769425422D+0
C
C     EXPANSION (0042) EVALUATED AS Y(T)  --PRECISION 19E.20
C19   Y = (((((((((((((((+5.9328471386030080000D-15
C19  *    *T-1.5956078883045376000D-14)*T+1.7676385864941568000D-14)
C19  *    *T-6.0294975574048768000D-14)*T+2.5638729029451776000D-13)
C19  *    *T-8.5001781935658188800D-13)*T+2.8041977495258521600D-12)
C19  *    *T-1.1028979187478731776D-11)*T+3.4986255787636560384D-11)
C19  *    *T-2.2288785937381626317D-10)*T+1.7534899672904838566D-10)
C19  *    *T-9.4155357282462658294D-9)*T-4.1604479109861132202D-8)
C19  *    *T-7.6917762531067926201D-7)*T-6.3169239835330053157D-6)
C19  *    *T-9.0255334518541784518D-5)*T-9.2555146476562980020D-4
C19   Y = (Y*T-1.7268365238532168193D-2)*T + 1.2368866476942542207D+0
C
      S18ACF = EXP(-X)*Y/SQRT(X)
      GO TO 140
C
C     ERROR 1 EXIT
  120 IFAIL = P01ABF(IFAIL,1,SRNAME,0,P01REC)
      S18ACF = 0.0D0
C
  140 RETURN
      END
